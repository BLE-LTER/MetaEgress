<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How to use <code>MetaEgress</code> to generate EML document from LTER-core-metabase • MetaEgress</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How to use &lt;code&gt;MetaEgress&lt;/code&gt; to generate EML document from LTER-core-metabase">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MetaEgress</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/usage_example.html">How to use `MetaEgress` to generate EML document from LTER-core-metabase</a>
    </li>
    <li>
      <a href="../articles/use_dump.html">Use sample database dump to test drive `MetaEgress`</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>How to use <code>MetaEgress</code> to generate EML document from LTER-core-metabase</h1>
            
      
      
      <div class="hidden name"><code>usage_example.Rmd</code></div>

    </div>

    
    
<p>Last updated: 13 September, 2019</p>
<p>This is an example workflow from metabase to EML document. This guide assumes you have an installed and populated instance of LTER-core-metabase, plus log-in credentials for an user with at least read or SELECT access to this database. See the <a href="https://github.com/lter/LTER-core-metabase">LTER-core-metabase Github repository</a> for information on installation and population. If you would like to test drive <code>MetaEgress</code>, use the database dump specifically made for this purpose; see <a href="use_dump.html">this document</a>.</p>
<div id="outline" class="section level2">
<h2 class="hasAnchor">
<a href="#outline" class="anchor"></a>Outline</h2>
<ul>
<li><a href="#preparation">Preparation</a></li>
<li><a href="#set-up-in-r">Set up in R</a></li>
<li><a href="#connect-and-query-from-lter-core-metabase">Connect and query from LTER-core-metabase</a></li>
<li><a href="#create-entities">Create entities</a></li>
<li><a href="#create-eml">Create EML</a></li>
<li><a href="#validate-and-write-to-file">Validate and write to file</a></li>
<li><a href="#troubleshoot-invalid-eml">Troubleshoot invalid EML</a></li>
</ul>
</div>
<div id="preparation" class="section level2">
<h2 class="hasAnchor">
<a href="#preparation" class="anchor"></a>Preparation</h2>
<div id="necessary-components" class="section level3">
<h3 class="hasAnchor">
<a href="#necessary-components" class="anchor"></a>Necessary components</h3>
<p>(aside from well populated metabase)</p>
<ul>
<li>An abstract document in pandoc-compatible format. The file name should be exactly as specified in metabase <code>DataSet.Abstract</code>.</li>
<li>A method document in pandoc-compatible format. The file name should be exactly as specified in metabase <code>DataSetMethods.methodDocument</code>.</li>
<li>A boilerplate XML file (see <a href="#filling-out-a-boilerplate-for-your-project">Filling out a boilerplate for your project</a>).</li>
<li>A license document in pandoc-compatible format.</li>
<li>Data files for all listed entities. File names should be exactly as listed in metabase <code>DataSetEntities.FileName</code>.</li>
</ul>
<p><strong>Note on document formats</strong></p>
<p><code>MetaEgress</code> uses the function <code>set_TextType</code> from the EML R package to wrap documents in XML tags. See <code>set_TextType</code> documentation to learn more about compatible formats: <code><a href="https://www.rdocumentation.org/packages/EML/topics/set_TextType">?EML::set_TextType</a></code>.</p>
</div>
<div id="filling-out-a-boilerplate-for-your-project" class="section level3">
<h3 class="hasAnchor">
<a href="#filling-out-a-boilerplate-for-your-project" class="anchor"></a>Filling out a boilerplate for your project</h3>
<p>There are certain EML elements that you might wish to include in an EML document and that are not represented in LTER-core-metabase. This might change in the future. However, these are generally general information about the research project that do not normally change between datasets. For normal usage at LTER sites, these are trees at the following XPaths:</p>
<ul>
<li>eml/access</li>
<li>eml/dataset/distribution</li>
<li>eml/dataset/publisher</li>
<li>eml/dataset/contact</li>
<li>eml/dataset/project</li>
</ul>
<p>Fill out these trees as applicable to your LTER site or project. Refer to the <a href="https://environmentaldatainitiative.files.wordpress.com/2017/11/emlbestpractices-v3.pdf">EML best practices v3</a> document. Save the XML file in your project folder (see below).</p>
<p><strong>NOTE:</strong> <code>MetaEgress</code> will not read in other XML tags not contained in the above trees.</p>
</div>
<div id="set-up-a-local-project-folder" class="section level3">
<h3 class="hasAnchor">
<a href="#set-up-a-local-project-folder" class="anchor"></a>Set up a local project folder</h3>
<p>Put data files and other documents (e.g. abstract, methods, boilerplate, license) in a folder.</p>
<p>Recommended approach for local files: Create a R script in this folder and run <code>MetaEgress</code> from this script.</p>
<p>For remotely hosted data: TODO</p>
</div>
<div id="remotely-hosted-data" class="section level3">
<h3 class="hasAnchor">
<a href="#remotely-hosted-data" class="anchor"></a>Remotely hosted data</h3>
<p>TODO</p>
</div>
</div>
<div id="set-up-in-r" class="section level2">
<h2 class="hasAnchor">
<a href="#set-up-in-r" class="anchor"></a>Set up in R</h2>
<p>In the project R script:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># Load MetaEgress into R environment</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(MetaEgress)</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co"># Set working directory to current script's directory</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/getwd">setwd</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/basename">dirname</a></span>(rstudioapi<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rstudioapi/topics/rstudio-editors">getActiveDocumentContext</a></span>()<span class="op">$</span>path))</a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co"># Set paths to boilerplate XML file and license document</span></a>
<a class="sourceLine" id="cb1-8" title="8">boilerplate_path &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/normalizePath">normalizePath</a></span>(<span class="st">"./00_Shared_document/boilerplate.xml"</span>)</a>
<a class="sourceLine" id="cb1-9" title="9">license_path &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/normalizePath">normalizePath</a></span>(<span class="st">"./00_Shared_document/IntellectualRights.docx"</span>)</a></code></pre></div>
</div>
<div id="connect-and-query-from-lter-core-metabase" class="section level2">
<h2 class="hasAnchor">
<a href="#connect-and-query-from-lter-core-metabase" class="anchor"></a>Connect and query from LTER-core-metabase</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># View documentation</span></a>
<a class="sourceLine" id="cb2-2" title="2">?get_meta</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co"># Use function</span></a>
<a class="sourceLine" id="cb2-5" title="5">metadata &lt;-</a>
<a class="sourceLine" id="cb2-6" title="6"><span class="st">  </span><span class="kw"><a href="../reference/get_meta.html">get_meta</a></span>(</a>
<a class="sourceLine" id="cb2-7" title="7">    <span class="dt">dbname =</span> <span class="st">"metabase"</span>,       <span class="co"># change to your DB name</span></a>
<a class="sourceLine" id="cb2-8" title="8">    <span class="dt">schema =</span> <span class="st">"mb2eml_r"</span>,       <span class="co"># change to schema containing views</span></a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="dt">dataset_ids =</span> <span class="dv">1</span>,           <span class="co"># change to ID or numeric vector of IDs wanted</span></a>
<a class="sourceLine" id="cb2-10" title="10">    <span class="dt">host =</span> <span class="st">"localhost"</span>,        <span class="co"># change to IP address if remote host</span></a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="dt">port =</span> <span class="dv">5432</span>,</a>
<a class="sourceLine" id="cb2-12" title="12">    <span class="dt">user =</span> <span class="ot">NULL</span>,               <span class="co"># change to username and password to save time or if not using RStudio</span></a>
<a class="sourceLine" id="cb2-13" title="13">    <span class="dt">password =</span> <span class="ot">NULL</span>            <span class="co"># if NULL, RStudio will create pop-up windows asking for username and password</span></a>
<a class="sourceLine" id="cb2-14" title="14">  )</a></code></pre></div>
</div>
<div id="create-entities" class="section level2">
<h2 class="hasAnchor">
<a href="#create-entities" class="anchor"></a>Create entities</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># View documentation</span></a>
<a class="sourceLine" id="cb3-2" title="2">?create_entity_all</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co"># Use the function</span></a>
<a class="sourceLine" id="cb3-5" title="5">entities &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create_entity_all.html">create_entity_all</a></span>(</a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="dt">meta_list =</span> metadata,   <span class="co"># list returned by `get_meta`</span></a>
<a class="sourceLine" id="cb3-7" title="7">  <span class="dt">dataset_id =</span> <span class="dv">1</span>          <span class="co"># a singular dataset ID</span></a>
<a class="sourceLine" id="cb3-8" title="8">)</a></code></pre></div>
<p><strong>Note</strong> that even if the function runs successfully, many warnings will likely be generated. Use <code><a href="https://www.rdocumentation.org/packages/base/topics/warnings">warnings()</a></code> to see them. Most of the time the warnings will be about custom units and can safely be ignored.</p>
</div>
<div id="create-eml" class="section level2">
<h2 class="hasAnchor">
<a href="#create-eml" class="anchor"></a>Create EML</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># View documentation</span></a>
<a class="sourceLine" id="cb4-2" title="2">?create_EML</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co"># Use the function</span></a>
<a class="sourceLine" id="cb4-5" title="5">EML &lt;-</a>
<a class="sourceLine" id="cb4-6" title="6"><span class="st">  </span><span class="kw"><a href="../reference/create_EML.html">create_EML</a></span>(</a>
<a class="sourceLine" id="cb4-7" title="7">    <span class="dt">meta_list =</span> metadata,                 <span class="co"># list returned by `get_meta`</span></a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="dt">entity_list =</span> entities,               <span class="co"># list returned by `create_entity_all`</span></a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="dt">dataset_id =</span> <span class="dv">1</span>,                       <span class="co"># a singular dataset ID</span></a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="dt">boilerplate_path =</span> boilerplate_path,  <span class="co"># path to boilerplate XML file</span></a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="dt">license_path =</span> license_path           <span class="co"># path to license document</span></a>
<a class="sourceLine" id="cb4-12" title="12">)</a></code></pre></div>
</div>
<div id="validate-and-write-to-file" class="section level2">
<h2 class="hasAnchor">
<a href="#validate-and-write-to-file" class="anchor"></a>Validate and write to file</h2>
<p>First validate EML document using the function <code>eml_validate</code> from EML R package. The input could be an EML list object or output from <code>create_entity</code>, or a XML file.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">EML<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/EML/topics/eml_validate">eml_validate</a></span>(EML)</a></code></pre></div>
<p>Desired outcome is TRUE:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">[<span class="dv">1</span>] <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attr">attr</a></span>(,<span class="st">"errors"</span>)</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">character</a></span>(<span class="dv">0</span>)</a></code></pre></div>
<p>Should <code>eml_validate</code> return FALSE, examine the list object returned by <code>create_EML</code>. Error messages by <code>eml_validate</code> could be quite cryptic and might not point to the real problem.</p>
<p>Then serialize or write to XML file using the function <code>write_eml</code> from the EML R package.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">EML<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/EML/topics/write_eml">write_eml</a></span>(EML, <span class="dt">file =</span> <span class="st">"EML.xml"</span>)</a></code></pre></div>
</div>
<div id="troubleshoot-invalid-eml" class="section level2">
<h2 class="hasAnchor">
<a href="#troubleshoot-invalid-eml" class="anchor"></a>Troubleshoot invalid EML</h2>
<p>TODO</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#outline">Outline</a></li>
      <li><a href="#preparation">Preparation</a></li>
      <li><a href="#set-up-in-r">Set up in R</a></li>
      <li><a href="#connect-and-query-from-lter-core-metabase">Connect and query from LTER-core-metabase</a></li>
      <li><a href="#create-entities">Create entities</a></li>
      <li><a href="#create-eml">Create EML</a></li>
      <li><a href="#validate-and-write-to-file">Validate and write to file</a></li>
      <li><a href="#troubleshoot-invalid-eml">Troubleshoot invalid EML</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by An T. Nguyen, Li Kui.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
